<%- include("partials/header.ejs") %>


<body>
  <header class="top-header">
    <nav class="sidebar">
      <div class="sidebar-header">
        <i class="ri-arrow-left-line sidebar-close"></i>
      </div>
      <ul class="sidebar-nav">
        <li><a href="/home">Home</a></li>
        <li><a href="/shop">Winkel</a></li>
        <li><a href="/friendslist">Vriendenlijst</a></li>
        <li><a href="/settings">Instellingen</a></li>
      </ul>
      <div class="sidebar-bottom">
        <div class="user-circle">
          <img class="user profileAvatarHeader" src="/assets/images/default-avatar.png" />
        </div>
        <span><%= session.username %></span>
        <span><a href="/logout">Uitloggen</a></span>
      </div>
    </nav>
    <div class="overlay"></div>
    <i class="ri-menu-line"></i>
    <h1 class="logo"><a href="/homePage">ICONS</a></h1>
    <div class="nav-items-right">
      <div class="mode-toggle-right">
        <label class="switch">
          <input type="checkbox" id="modeSwitch">
          <span class="slider round">
            <i class="ri-sun-line sun-icon"></i>
            <i class="ri-moon-line moon-icon"></i>
          </span>
        </label>
      </div>
      <img class="user profile__avatar profileAvatarHeader header-user-avatar" src="/assets/images/default-avatar.png" />
      <div class="account-card">
        <ul class="list">
          <li class="element">
            <a href="/profile" class="label"><i class="ri-account-box-2-fill"></i>Profiel</a>
          </li>
          <li class="element">
            <a href="/settings" class="label"><i class="ri-settings-5-fill"></i>Instellingen</a>
          </li>
          <div class="separator"></div>
          <li class="element">
            <a href="/logout" class="label"><i class="ri-logout-box-r-fill"></i>Uitloggen</a>
          </li>
        </ul>
      </div>
    </div>
  </header>


  <main class="selection-container">
    <div class="selection-grid">
      <!-- Character Selectie -->
      <div class="selection-options" id="characterOptions">
        <% const availableSkins = ['1', '2', '3', '4', '5']; %>
        <% availableSkins.forEach(skinId => { %>
        <% if (user.inventory.includes(skinId)) { %>
        <div class="option-item" onclick="selectItem('character', '<%= skinId %>')" data-skin-id="<%= skinId %>">
          <img src="assets/images/skin<%= skinId %>.webp" alt="Character Skin <%= skinId %>">
        </div>
        <% } else { %>
        <div class="option-item locked">
          <img src="assets/images/skin<%= skinId %>.webp" alt="Locked Skin <%= skinId %>" class="grayscale">
          <div class="lock-overlay">
            <i class="ri-lock-line"></i>
          </div>
        </div>
        <% } %>
        <% }); %>
      </div>

      <!-- Weapon Selectie -->
      <div class="selection-card">
        <h2 class="selection-title"><i class="ri-sword-fill"></i> Select Weapon</h2>
        <div class="selection-main" onclick="toggleSelection('weapon')">
          <img src="assets/images/placeholder.png" alt="Weapon" id="weaponPreview">
        </div>
        <div class="selection-options" id="weaponOptions">
          <% for(let i=1; i<=5; i++) { %>
          <div class="option-item" onclick="selectItem('weapon', <%=i %>)">
            <img src="assets/images/weapon<%=i %>.webp" alt="Weapon <%=i %>">
          </div>
          <% } %>
        </div>
      </div>

      <!-- Emote Selectie -->
      <div class="selection-card">
        <h2 class="selection-title"><i class="ri-emotion-happy-fill"></i> Select Emote</h2>
        <div class="selection-main" onclick="toggleSelection('emote')">
          <img src="assets/images/placeholder.png" alt="Emote" id="emotePreview">
        </div>
        <div class="selection-options" id="emoteOptions">
          <% for(let i=1; i<=5; i++) { %>
          <div class="option-item" onclick="selectItem('emote', <%=i %>)">
            <img src="assets/images/emote<%=i %>.png" alt="Emote <%=i %>">
          </div>
          <% } %>
        </div>
      </div>
    </div>

    <!-- Continue Sectie -->
    <div class="continue-section hidden" id="continueSection">
      <button class="continue-button" id="continueButton">
        Continue to Battle
        <i class="ri-arrow-right-double-line"></i>
      </button>
    </div>

    <!-- Empty Frame -->
    <div id="battleFrame" class="battle-frame hidden"></div>
  </main>

  <script>
    const loggedInUserId = "<%= session.userId %>";

    document.addEventListener('DOMContentLoaded', async () => {
      try {
        const res = await fetch(`/api/profile/id/${loggedInUserId}`);
        const user = await res.json();
        const avatarUrl = user.avatarUrl || '/assets/images/default-avatar.png';

        document.querySelectorAll('.profileAvatarHeader').forEach(img => {
          img.src = avatarUrl;
        });
      } catch (err) {
        console.error('Failed to load avatar for header:', err);
      }
    });
  </script>
</body>

<%- include("partials/footer.ejs") %>